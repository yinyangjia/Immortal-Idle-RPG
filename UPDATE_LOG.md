# 📜 万古仙途：无限数值 - 开发同步手册

## 📌 当前项目状态
- **版本:** v1.0.0 (基础框架版)
- **开发阶段:** 核心引擎部署
- **当前机制:** 自动挂机、1秒回合制战斗、数值突破系统。

## ⚔️ 核心战斗属性 (Combat Stats)
- **HP (生命):** 归零则战斗失败。
- **ATK (攻击):** 基础输出。
- **DEF (防御):** 减免伤害。
- **PEN (破甲):** 削减对方防御力。
- **公式:** `实际伤害 = Max(1, 攻击 - (防御 - 破甲))`

## 🌍 地图与机制 (Maps)
1. **野外挂机 (Field):** 自动循环，怪物强度随玩家战力浮动。
2. **挑战首领 (Boss):** 强力数值检测，用于获取大量修为。
3. **镇妖无限塔 (Tower):** 指数级数值增长，每10层一个小坎，奖励永久加成。

## 🛠️ 全局变量与字典
- **存储方式:** `localStorage` (本地存档)
- **主要变量:** `realmIdx` (境界索引), `towerFloor` (塔层数), `exp` (当前修为)

# 📜 万古仙途：无限数值 - 开发同步手册

## 📌 项目状态
- **版本:** v1.1.0 (经济与历练更新)
- **更新时间:** 2026-02-14
- **核心变更:** 野外怪物选择、货币系统、背包界面。

## 💰 经济与背包系统 (Economy)
- **货币:** `money` (灵石)，击杀野外怪物和BOSS掉落。
- **背包:** `inventory` (对象存储)，格式 `{ "物品名": 数量 }`。
- **界面:** 新增 `modal` 弹窗类，用于显示背包和怪物列表。

## 🌍 地图机制更新 (Maps v2)
1. **野外 (Field):** - 不再单一刷怪。
   - 玩家需手动选择挑战的怪物等级（如：野兔 vs 玄水巨蟒）。
   - 收益与风险成正比。
2. **镇妖塔 (Tower):** 保持指数增长。
3. **BOSS:** 固定高收益挑战。

## 🛠️ 文件变动记录
- `index.html`: 重构布局，修复缩进，增加背包/选择器弹窗结构。
- `js/data.js`: 新增 `fieldMonsters` 数组配置。
- `js/engine.js`: 重写 `loop` 逻辑，增加 `switchMap` 的弹窗判定，增加 `gainReward` 结算函数。
- `style.css`: 增加 `.modal` 和 `.grid-list` 样式。

## 🐛 待办/已知问题
- 暂时物品还没有实际使用效果（如吃丹药），仅作为收集品。
- 需要在后续增加“商店”或“物品使用”逻辑。

- # [2026-02-14] - v1.2.0 (装备与合成系统)
- **新功能:** 角色全屏面板，替换了旧背包。
- **装备系统:** 7个部位 (头、项链、武、甲、裤、鞋、饰)。
- **掉落机制:** 野外怪物现在掉落对应阶级的装备。
- **合成机制:** 3个同名低阶装备 -> 1个高阶装备 (最高20阶)。
- **属性重构:** 引入 `baseStats` (裸装) + 装备加成的计算公式。

# [2026-02-15] - v1.3.1 (逻辑修正与战斗回显)
- **修复**: 解决了材料（兽皮/道韵）显示为 `undefined` 的 Bug。
- **修复**: 修正合成逻辑中出现的 `NaN` 阶级装备显示错误。
- **恢复**: 修复了战斗信息在主界面消失的问题，重定向日志输出。
- **新增**: 背包物品增加 [出售] 功能，可将多余材料/装备转化为灵石。
- **优化**: 调整了 1-20 阶装备的属性成长曲线，防止后期数值溢出。

- # [2026-02-15] - v1.4.0 (离线挂机与商城系统)
1. **数值调整**: 装备掉落率小幅上调；境界突破属性加成由 1.3x 提升至 1.5x（大境界）。
2. **平滑曲线**: 扩充野外怪物至 100 级，每 5 级一个台阶，确保升级不卡点。
3. **战斗修复**: 重写 Logger 逻辑，确保战斗信息实时回显。
4. **离线挂机**: 核心功能上线！根据离线时间自动结算挂机怪物的修为与掉落。
5. **商城系统**: 增加灵石商城，出售各级首领挑战券。
6. **首领重制**: 挑战首领需消耗挑战券，奖励大幅提升，增加多等级首领。
